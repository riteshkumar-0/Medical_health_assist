<div class="container py-4">
  <!-- Page Header -->
  <div class="page-header mb-4">
    <h2 class="fw-bold">
      <i class="bi bi-lightbulb text-warning me-2"></i>Integrated Health Insights Dashboard
    </h2>
    <p class="text-muted">Combines all prompt templates into a unified service â€” delivering end-to-end AI-powered health intelligence.</p>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="alert alert-danger d-flex align-items-center mb-4">
    <i class="bi bi-exclamation-triangle-fill me-2"></i> {{ error }}
  </div>

  <!-- Section 1: Health Insights -->
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body p-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h5 class="card-title fw-bold mb-0">
          <i class="bi bi-graph-up me-2 text-warning"></i>Market & Product Insights
        </h5>
        <button class="btn btn-warning btn-lg" (click)="generateInsights()" [disabled]="loadingInsights">
          <span *ngIf="loadingInsights" class="spinner-border spinner-border-sm me-2"></span>
          <i *ngIf="!loadingInsights" class="bi bi-stars me-2"></i>
          {{ loadingInsights ? 'Generating...' : 'Generate Insights' }}
        </button>
      </div>

      <!-- Loading -->
      <div *ngIf="loadingInsights" class="text-center py-5">
        <div class="spinner-border text-warning" style="width: 3rem; height: 3rem;"></div>
        <p class="mt-3 text-muted">AI is analyzing the entire product catalog... This may take a moment.</p>
      </div>

      <!-- Insights Result -->
      <div *ngIf="insightsResult">
        <div class="row g-3 mb-4">
          <div class="col-md-4">
            <div class="p-3 bg-warning bg-opacity-10 rounded-3 text-center">
              <h3 class="fw-bold text-warning mb-0">{{ insightsResult.totalProducts }}</h3>
              <small class="text-muted">Products Analyzed</small>
            </div>
          </div>
          <div class="col-md-4">
            <div class="p-3 bg-info bg-opacity-10 rounded-3 text-center">
              <h3 class="fw-bold text-info mb-0">{{ insightsResult.categories.length }}</h3>
              <small class="text-muted">Categories</small>
            </div>
          </div>
          <div class="col-md-4">
            <div class="p-3 bg-success bg-opacity-10 rounded-3 text-center">
              <h3 class="fw-bold text-success mb-0">AI</h3>
              <small class="text-muted">Powered Analysis</small>
            </div>
          </div>
        </div>
        <div class="d-flex flex-wrap gap-2 mb-3">
          <span *ngFor="let cat of insightsResult.categories" class="badge bg-warning text-dark">
            {{ cat }}
          </span>
        </div>
        <hr>
        <div class="insights-content" [innerHTML]="insightsResult.insights | formatMarkdown"></div>
        <div class="text-end mt-3">
          <span class="badge bg-secondary">Template: {{ insightsResult.templateUsed }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Section 2: Wellness Recommendations -->
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body p-4">
      <h5 class="card-title fw-bold mb-4">
        <i class="bi bi-heart me-2 text-danger"></i>Personalized Wellness Recommendations
      </h5>

      <div class="row g-3 align-items-end mb-4">
        <div class="col-md-6">
          <label class="form-label fw-semibold">Select Product</label>
          <select class="form-select" [(ngModel)]="selectedProductId" [disabled]="loadingProducts">
            <option value="">-- Choose a product --</option>
            <option *ngFor="let product of products" [value]="product.productId">
              {{ product.productName }}
            </option>
          </select>
        </div>
        <div class="col-md-4">
          <button class="btn btn-outline-danger btn-lg w-100" (click)="getWellnessRecommendations()"
                  [disabled]="loadingWellness || !selectedProductId">
            <span *ngIf="loadingWellness" class="spinner-border spinner-border-sm me-2"></span>
            <i *ngIf="!loadingWellness" class="bi bi-heart-pulse me-2"></i>
            {{ loadingWellness ? 'Loading...' : 'Get Recommendations' }}
          </button>
        </div>
      </div>

      <!-- Loading -->
      <div *ngIf="loadingWellness" class="text-center py-4">
        <div class="spinner-border text-danger" style="width: 3rem; height: 3rem;"></div>
        <p class="mt-3 text-muted">Generating personalized recommendations...</p>
      </div>

      <!-- Wellness Result -->
      <div *ngIf="wellnessResult" class="mt-3">
        <div class="p-3 bg-danger bg-opacity-10 rounded-3 mb-3">
          <strong>Product:</strong> {{ wellnessResult.productName }} |
          <strong>Category:</strong> <span class="badge bg-danger">{{ wellnessResult.category }}</span>
        </div>
        <div class="wellness-content" [innerHTML]="wellnessResult.recommendations | formatMarkdown"></div>
        <div class="text-end mt-3">
          <span class="badge bg-secondary">Template: {{ wellnessResult.templateUsed }}</span>
        </div>
      </div>
    </div>
  </div>
</div>
